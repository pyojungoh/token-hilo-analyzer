---
description: 계산기 배팅중 → 자동배팅기 즉시 전달 규칙. 코딩 전 반드시 파악할 것.
globs: app.py, auto-betting-macro/**/*.py
alwaysApply: true
---

# 배팅중 → 자동배팅기 즉시 전달 (절대 규칙)

**코딩하기 전에 이 규칙을 반드시 파악할 것.**

## 기본 원칙

1. **계산기 상단 "배팅중"**에 픽이 들어오자마자 **자동배팅기에도 즉시** 픽이 전달되어야 한다.
2. **회차·픽** 검증 후 **바로 ADB로 배팅**해야 한다.
3. **매크로 금액 = 매크로 내부에서만 계산** — round_actuals + _bet_history 기반 마틴. 서버 suggested_amount 사용 금지.

## 데이터 흐름 (변형 금지)

```
[서버]  round, pick_color, pick_pred → relay / WebSocket
       │
       ▼
[자동배팅기]  round_actuals(macro-data) + _bet_history → 내부 마틴 계산 → 금액
       │
       └─ ADB 배팅 (회차·픽·금액)
```

## 매크로 금액 계산 (절대 규칙)

- **매크로**: round_actuals(macro-data) + _bet_history로 마틴 단계·금액 계산. 서버 suggested_amount 사용 금지.
- **시작 금액**: base_bet_edit / macro_base (coords). 표마틴 9단계.

## 안정화 규칙 (들어왔다 보류떴다 방지)

- **POST null/보류 수신 시**: 캐시 덮어쓰지 않음. 유효 (round, pick) 있을 때만 캐시 갱신.
- **매크로 표시**: null 수신 시 기존 유효 표시 유지.

## 수정 시 금지

- 매크로에서 서버 suggested_amount로 배팅 금지 — 내부 계산만 사용
- `_display_best_amount`를 배팅 금액으로 사용 금지 (표시용만)

---

상세: `docs/AUTO_BETTING_AMOUNT_RULES.md`, `docs/AUTO_BETTING_DATA_FLOW.md`
