---
description: 승률방향 반픽 민감도 조정 — 포인트값만 수정. "승률방향 조정" 요청 시 반드시 이 규칙 참고.
globs: app.py
alwaysApply: true
---

# 승률방향 민감도 조정 규칙 (절대 준수)

사용자가 **승률방향 조정**, **승률방향 민감도**, **오름/내림 판단** 등으로 요청하면 **반드시** 아래 방식만 따른다.

## ⛔ 원칙: 포인트값만 수정

- 오름/내림 판단을 바꾸려면 **아래 4개 포인트값만** 수정한다.
- 다른 로직(예: 쿨다운, last_trend_direction 분기 등)을 추가·변경하지 않는다.
- **서버·클라이언트·패널** 모두 동일한 값으로 맞춰야 한다.

## 저점/고점 고정 밴드 (로직 유지)

- **저점 부근**: 현재 50회 승률 ≤ 43% → 저점에서 오름세면 정픽(low_rising).
- **고점 부근**: 현재 50회 승률 ≥ 57% → 고점에서 내림세면 반대픽(high_falling).
- 서버·클라이언트·패널 모두 `WIN_RATE_LOW_BAND = 43`, `WIN_RATE_HIGH_BAND = 57` 동일 적용.

## 포인트값 목록 (DELTA/RATIO)

| 상수 | 위치 | 현재값 | 효과 |
|------|------|--------|------|
| **WIN_RATE_DIR_DELTA4** | 서버 `_server_win_rate_direction_zone` | 0.35 | 4구간 차이 %p — 오름/내림 판정 |
| **WIN_RATE_DIR_DELTA5** | 서버 `_server_win_rate_direction_zone` | 0.42 | 5구간 차이 %p — 고점하락/저점상승 판정 |
| ratio_dynamic 0.52 / 0.5 | 동일 | 0.52, 0.5 | 중간 구간 정픽/반대픽 기준 |

## 수정 시 반드시 같이 바꿀 위치

1. **서버**: `app.py` `_server_win_rate_direction_zone` 함수 내 `WIN_RATE_DIR_*` 상수
2. **클라이언트 getWinRateDirectionZone**: `app.py` 내 `var D4 = 0.35, D5 = 0.42, R_LOW = 0.52, R_HIGH = 0.5;`
3. **클라이언트 renderWinRateDirectionPanel** (방향·추세 구간): `d4 = 0.35`, `d5 = 0.42`, `R_LOW = 0.52`

세 곳 모두 동일한 숫자로 맞출 것.

## 민감도 조정 가이드

| 현상 | 조치 |
|------|------|
| 방향이 3~4회만에 자주 바뀜 | DELTA4, DELTA5 **값 올리기** (보수적) |
| 오름인데 반대로 감 | RATIO_LOW **값 내리기** (0.52 → 0.5 등) |
| 반대픽이 너무 늦게/안 들어감 | RATIO_HIGH **값 올리기** 또는 DELTA4/DELTA5 **내리기** |
| 정픽이 너무 늦게/안 들어감 | RATIO_LOW **값 내리기** |

---

이 규칙을 수정·확장할 때는 "포인트값만 수정" 원칙을 유지한다.
