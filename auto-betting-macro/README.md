# 자동 배팅 매크로

Analyzer 서버의 예측 픽(`/api/current-pick`)을 폴링해서, RED/BLACK 픽이 바뀔 때 배팅 사이트 페이지에서 해당 버튼을 자동으로 클릭하는 데스크톱 프로그램입니다.

- **프로그램 안에 배팅 사이트가 뜹니다.** (PyQt5 + QWebEngineView) 왼쪽은 설정/로그, 오른쪽은 내장 브라우저로 배팅 사이트가 표시됩니다.
- RED/BLACK 버튼은 **CSS 셀렉터**(예: `#red-btn`) 또는 **좌표 (x,y)**(예: `120,300`)로 지정할 수 있습니다.

## 요구 사항

- Python 3.8+
- Analyzer 서버가 떠 있어야 하고, DB에 `current_pick`이 저장되는 환경이어야 합니다. (웹에서 결과 페이지를 열고 계산기/예측이 동작하면 픽이 저장됩니다.)

## 설치

1. 터미널(또는 명령 프롬프트)을 열고, 프로젝트의 매크로 폴더로 이동합니다.
   ```bash
   cd token-hilo-analyzer/auto-betting-macro
   ```
2. Python 패키지를 설치합니다. (PyQt5, PyQtWebEngine, requests)
   ```bash
   pip install -r requirements.txt
   ```

## 에뮬레이터 자동배팅 매크로 (ADB) — 한곳에 통합

**실행**: `python emulator_macro.py` 또는 `run-emulator-macro.bat`

한 창에서 다음을 모두 처리합니다.

- **설정**: Analyzer URL, 계산기 1/2/3 선택, 배팅 금액, ADB 기기(예: 127.0.0.1:5555)
- **좌표 설정**: 배팅금액·정정·레드·블랙 좌표 찾기 (버튼 누르면 창 최소화 → LDPlayer 화면에서 해당 위치 클릭 → `emulator_coords.json` 저장). 기본 배팅금액 저장 포함.
- **표시**: 회차(★△○), 금액, 배팅픽, 정/꺽 카드, 경고·합선·승률
- **동작**: **시작**을 누르면 **다음 픽부터** 배팅 (금액 입력 → 정정 → RED/BLACK 탭, ADB)

의존성: `pynput` (좌표 찾기용), `PyQt5`, `requests` (pip install -r requirements.txt).

## 실행

1. 터미널에서 매크로를 실행합니다.
   ```bash
   python macro.py
   ```
2. **Analyzer URL** 입력란에 예측 픽을 가져올 서버 주소를 넣습니다.
   - 로컬: `http://127.0.0.1:5000`
   - Railway 등 배포 주소: `https://your-app.railway.app` (끝에 `/` 없이)
3. **배팅 사이트 URL** 입력란에 배팅할 사이트 주소를 넣은 뒤 **「사이트 열기(이동)」** 버튼을 누르면, 오른쪽 내장 브라우저에 해당 사이트가 뜹니다.
   - **「테스트 페이지 열기」** 를 누르면 같은 폴더의 `test_betting_page.html` 이 열립니다. 금액 칸 / RED / BLACK 좌표를 잡고 **시작** 하면 매크로 동작(금액 입력 → 픽 클릭)을 바로 확인할 수 있습니다.
4. **RED 버튼** 입력란에 RED 배팅 버튼을 지정합니다.
   - **CSS 셀렉터**: 예) `#red-btn` 또는 `.btn-red` (아래 "셀렉터/좌표 찾는 방법" 참고)
   - **좌표**: 예) `120,300` (숫자,쉼표,숫자만, 공백 없어도 됨)
5. **BLACK 버튼** 입력란에 BLACK 배팅 버튼을 같은 방식으로 지정합니다.
6. **폴링 간격(초)**에 `2` 정도 입력합니다. (1~10 초 단위로 픽을 확인하는 주기)
7. **시작** 버튼을 누르면 픽 폴링이 시작되고, 픽이 바뀔 때마다 **오른쪽에 뜬 배팅 사이트**에서 해당 버튼이 자동으로 클릭됩니다.
8. **중지** 버튼을 누르면 폴링이 멈춥니다. (내장 브라우저는 그대로 둘 수 있음)

## RED/BLACK 셀렉터 또는 좌표 찾는 방법

### 셀렉터로 지정할 때

1. 배팅 사이트를 **일반 브라우저**(Chrome 등)로 연 뒤, RED(또는 BLACK) 배팅 버튼 위에서 **우클릭** → **검사**(또는 Inspect)를 선택합니다.
2. 개발자 도구에서 해당 버튼의 HTML이 선택된 상태로 뜹니다. 그 요소에 `id="red-btn"` 처럼 **id**가 있으면 셀렉터는 `#red-btn` 입니다.
3. **id**가 없고 `class="btn red"` 처럼 **class**만 있으면 `.btn.red` 또는 `.red` 처럼 입력합니다. (공백은 `.`으로 바꿉니다.)
4. 이렇게 구한 값을 매크로의 **RED 버튼** / **BLACK 버튼** 입력란에 그대로 넣으면 됩니다.

### 좌표(x, y)로 지정할 때

1. 매크로를 **시작**해서 Chromium으로 배팅 사이트가 열린 상태로 둡니다.
2. 브라우저 창 크기를 나중에 바꾸지 않을 정도로 한 번 고정해 둡니다.
3. RED(또는 BLACK) 버튼 **중앙**을 마우스로 가리킨 뒤, 개발자 도구 콘솔에서 다음을 입력해 좌표를 확인합니다. (배팅 사이트 페이지에서 F12 → Console 탭)
   - 버튼 위에서 **우클릭 → 검사**로 요소를 선택한 뒤, Console에 `$0.getBoundingClientRect()` 입력 후 Enter → 나온 `x`, `y`에 버튼 너비/높이 절반을 더해 **중앙** 좌표를 구할 수 있습니다.
   - 또는 화면 캡처 후 그림 보기 프로그램 등에서 픽셀 위치를 확인해, **페이지 기준** 대략적인 x, y 값을 넣어도 됩니다.
4. 구한 값을 `120,300` 처럼 **x,y** 형식으로 RED 버튼 / BLACK 버튼 입력란에 넣습니다.

## 픽/금액 출처 (macro.py)

- **계산기 1/2/3 선택 시**: 픽·회차·금액을 **`GET /api/current-pick?calculator=N`** 에서 가져옵니다. 분석기 웹의 해당 계산기(반픽/승률반픽/마틴/멈춤)와 동일한 픽·금액으로 배팅합니다.
- **계산기 미사용 또는 current_pick 비어 있을 때**: **`GET /api/results`** 의 `server_prediction`(메인 예측기)을 사용하고, 금액은 매크로 설정 기준금·마틴·승률반픽으로 계산합니다.

에뮬레이터 매크로(`emulator_macro.py`)는 항상 **current_pick**만 사용합니다.

## 사용 시 참고

- 배팅 사이트는 **프로그램 오른쪽**에 내장되어 있어 한 창에서 설정과 사이트를 함께 볼 수 있습니다.
- Analyzer 쪽에서 **결과 페이지를 열고 예측/계산기가 동작 중**이어야 `/api/current-pick`에 픽이 저장됩니다. 결과 페이지를 한 번이라도 열어 두고 매크로를 쓰는 것이 좋습니다.
